"use strict";(self.webpackChunkblize_angular=self.webpackChunkblize_angular||[]).push([[965],{5184:(Y,Z,d)=>{d.d(Z,{P:()=>J});var v=d(4655),C=d(6371),b=d(5242),x=d(4194),n=d(7716),e=d(6832),M=d(1802),y=d(702),D=d(3818),G=d(2849),R=d(1824),S=d(8583),A=d(9029),O=d(3679);const H=["scrollContent"];function U(u,P){1&u&&(n.TgZ(0,"span",28),n._UZ(1,"span",29),n._UZ(2,"span",29),n._UZ(3,"span",29),n.qZA())}const z=function(u){return{read:u}};function k(u,P){if(1&u&&n._UZ(0,"i",35),2&u){const l=n.oxw().$implicit;n.Q6J("ngClass",n.VKq(1,z,l.read))}}const B=function(u){return{me:u}};function F(u,P){if(1&u&&(n.TgZ(0,"div",30),n.TgZ(1,"div",31),n._UZ(2,"app-avatar",2),n.TgZ(3,"div",32),n._uU(4),n.TgZ(5,"span",33),n.YNc(6,k,1,3,"i",34),n._uU(7),n.ALo(8,"date"),n.qZA(),n.qZA(),n.qZA(),n.qZA()),2&u){const l=P.$implicit,a=n.oxw();n.Q6J("ngClass",n.VKq(10,B,(null==a.usersService.session?null:a.usersService.session.id)==(null==l.from?null:l.from.id))),n.xp6(2),n.Q6J("url",null==l.from?null:l.from.image)("nameShort",null==l.from?null:l.from.nameShort())("firstChar",null==l.from?null:l.from.firstChar()),n.xp6(2),n.hij(" ",l.text," "),n.xp6(2),n.Q6J("ngIf",(null==a.usersService.session?null:a.usersService.session.id)==(null==l.from?null:l.from.id)),n.xp6(1),n.hij(" ",n.xi3(8,7,l.date,"HH:mm")," ")}}const $=function(){return{standalone:!0}};let J=(()=>{class u{constructor(l,a,g,h,p,f,T){this.router=l,this.route=a,this.messagesService=g,this.usersService=h,this.ss=p,this.socketService=f,this.eventService=T,this.messages=[],this.input="",this.listLoading=!1,this.routerSubscription=this.router.events.subscribe(E=>{E instanceof v.m2&&(this.messages=[],this.listLoading=!1,this.getData())})}ngOnInit(){this.socketService.onMessage.subscribe(l=>{var a,g,h;(null===(a=l.from)||void 0===a?void 0:a.id)===(null===(g=this.getTo())||void 0===g?void 0:g.id)&&(this.messagesPush([l]),this.messagesService.read(null===(h=l.from)||void 0===h?void 0:h.id).subscribe(()=>{this.eventService.onRead.next({to:null==l?void 0:l.to})}))}),this.eventService.onMessage.subscribe(l=>{var a,g;(null===(a=l.to)||void 0===a?void 0:a.id)===(null===(g=this.getTo())||void 0===g?void 0:g.id)&&this.messagesPush([l])}),this.socketService.onTyping.subscribe(l=>{var a,g,h;(null===(a=l.from)||void 0===a?void 0:a.id)===(null===(g=this.getTo())||void 0===g?void 0:g.id)&&(null===(h=this.getTo())||void 0===h||h.setTyping(1===l.typing?new Date:void 0))}),this.socketService.onRead.subscribe(l=>{var a,g;(null===(a=l.from)||void 0===a?void 0:a.id)===(null===(g=this.getTo())||void 0===g?void 0:g.id)&&this.messages.forEach(h=>{var p,f;(null===(p=l.from)||void 0===p?void 0:p.id)===(null===(f=h.from)||void 0===f?void 0:f.id)&&(h.read=!0)})})}getData(){if(this.listLoading)return;const l=this.route.snapshot.paramMap.get("id"),a=this.messages.length,g=0===a;this.listLoading=!0,this.messagesService.detail(l,a).subscribe(h=>{u.to=(0,x.d8)(b.n,h.to),this.messagesPush(h.messages.map(p=>(0,x.d8)(C.v,p)),g),this.listLoading=!1,g&&this.messagesService.read(l).subscribe(()=>{this.eventService.onRead.next({to:this.getTo()})})})}send(){const l=this.route.snapshot.paramMap.get("id");this.input.trim().length>1&&(this.messagesService.add(l,this.input).subscribe(a=>{this.eventService.onMessage.next((0,x.d8)(C.v,a))}),this.input="")}sortMessages(){this.messages=this.messages.sort((l,a)=>{var g,h,p,f;return(null===(g=l.date)||void 0===g?void 0:g.getTime())>(null===(h=a.date)||void 0===h?void 0:h.getTime())?1:(null===(p=l.date)||void 0===p?void 0:p.getTime())<(null===(f=a.date)||void 0===f?void 0:f.getTime())?-1:0})}getTo(){return u.to}getOther(l){var a,g;return(null===(a=this.usersService.session)||void 0===a?void 0:a.id)===(null===(g=l.from)||void 0===g?void 0:g.id)?l.to:l.from}onInput(){this.socketService.socket.emit("typing",{to:this.getTo(),typing:this.input.length>0?1:0})}startCall(l){this.eventService.startCall.next({user:this.getTo(),video:l})}scrollToBottom(l=!1){var a;if(this.scrollContent){const g=null===(a=this.scrollContent)||void 0===a?void 0:a.nativeElement;(g.scrollHeight-g.scrollTop===g.clientHeight||l)&&setTimeout(()=>{g.scrollTop=g.scrollHeight-g.clientHeight})}}messagesPush(l,a){this.messages=this.messages.concat(l),this.sortMessages(),this.scrollToBottom(a)}ngOnDestroy(){this.routerSubscription.unsubscribe(),setTimeout(()=>{u.to=void 0})}}return u.\u0275fac=function(l){return new(l||u)(n.Y36(v.F0),n.Y36(v.gz),n.Y36(e.K),n.Y36(M.f),n.Y36(y.T),n.Y36(D.$c),n.Y36(G.P))},u.\u0275cmp=n.Xpm({type:u,selectors:[["app-chat"]],viewQuery:function(l,a){if(1&l&&n.Gf(H,5),2&l){let g;n.iGM(g=n.CRH())&&(a.scrollContent=g.first)}},decls:35,vars:13,consts:[[1,"container"],[1,"header"],[3,"url","nameShort","firstChar"],[1,"central",3,"routerLink"],[1,"name"],[1,"username"],["class","animate-typing",4,"ngIf"],[1,"actions"],[3,"click"],[1,"mdi","mdi-phone"],[1,"mdi","mdi-video"],[1,"mdi","mdi-dots-vertical"],[1,"chat-container"],["infiniteScroll","",1,"scroll",3,"scrollWindow","scrolledUp"],["scrollContent",""],[1,"items"],["class","item",3,"ngClass",4,"ngFor","ngForOf"],[3,"ngSubmit"],[1,"input-wrapper"],[1,"microphone"],[1,"mdi","mdi-microphone-outline"],["type","text","placeholder","Type your message....",3,"ngModel","ngModelOptions","input","ngModelChange"],[1,"paperclip"],[1,"mdi","mdi-paperclip"],[1,"image"],[1,"mdi","mdi-image-outline"],[1,"submit"],[1,"mdi","mdi-send"],[1,"animate-typing"],[1,"dot"],[1,"item",3,"ngClass"],[1,"item-wrapper"],[1,"text-wrapper"],[1,"time"],["class","mdi mdi-check-all",3,"ngClass",4,"ngIf"],[1,"mdi","mdi-check-all",3,"ngClass"]],template:function(l,a){if(1&l&&(n.TgZ(0,"div",0),n.TgZ(1,"div",1),n._UZ(2,"app-avatar",2),n.TgZ(3,"a",3),n.TgZ(4,"div",4),n._uU(5),n.qZA(),n.TgZ(6,"div",5),n._uU(7),n.YNc(8,U,4,0,"span",6),n.qZA(),n.qZA(),n.TgZ(9,"ul",7),n.TgZ(10,"li"),n.TgZ(11,"a",8),n.NdJ("click",function(){return a.startCall(!1)}),n._UZ(12,"i",9),n.qZA(),n.qZA(),n.TgZ(13,"li"),n.TgZ(14,"a",8),n.NdJ("click",function(){return a.startCall(!0)}),n._UZ(15,"i",10),n.qZA(),n.qZA(),n.TgZ(16,"li"),n.TgZ(17,"a"),n._UZ(18,"i",11),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(19,"div",12),n.TgZ(20,"div",13,14),n.NdJ("scrolledUp",function(){return a.getData()}),n.TgZ(22,"div",15),n.YNc(23,F,9,12,"div",16),n.qZA(),n.qZA(),n.qZA(),n.TgZ(24,"form",17),n.NdJ("ngSubmit",function(){return a.send()}),n.TgZ(25,"div",18),n.TgZ(26,"button",19),n._UZ(27,"i",20),n.qZA(),n.TgZ(28,"input",21),n.NdJ("input",function(){return a.onInput()})("ngModelChange",function(h){return a.input=h}),n.qZA(),n.TgZ(29,"button",22),n._UZ(30,"i",23),n.qZA(),n.TgZ(31,"button",24),n._UZ(32,"i",25),n.qZA(),n.qZA(),n.TgZ(33,"button",26),n._UZ(34,"i",27),n.qZA(),n.qZA(),n.qZA()),2&l){let g,h,p,f,T,E,L;n.xp6(2),n.Q6J("url",null==(g=a.getTo())?null:g.image)("nameShort",null==(h=a.getTo())?null:h.nameShort())("firstChar",null==(p=a.getTo())?null:p.firstChar()),n.xp6(1),n.MGl("routerLink","/profile/",null==(f=a.getTo())?null:f.username,""),n.xp6(2),n.AsE("",null==(T=a.getTo())?null:T.firstName," ",null==(T=a.getTo())?null:T.lastName,""),n.xp6(2),n.hij(" @",null==(E=a.getTo())?null:E.username," "),n.xp6(1),n.Q6J("ngIf",null==(L=a.getTo())?null:L.isTyping()),n.xp6(12),n.Q6J("scrollWindow",!1),n.xp6(3),n.Q6J("ngForOf",a.messages),n.xp6(5),n.Q6J("ngModel",a.input)("ngModelOptions",n.DdM(12,$))}},directives:[R.A,v.yS,S.O5,A.R,S.sg,O._Y,O.JL,O.F,O.Fj,O.JJ,O.On,S.mk],pipes:[S.uU],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;background-color:var(--bg-color-1)}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;height:100%}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;padding:1rem 1.5rem;border-bottom:1px solid var(--color-5)}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .central[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-left:.75rem}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .central[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;font-weight:600;color:var(--color-1)}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .central[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]{font-size:.75rem;line-height:1.5rem;color:var(--color-3)}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   ul.actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;margin-left:auto}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   ul.actions[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-left:.5rem}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   ul.actions[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:2.5rem;height:2.5rem;border-radius:50%;background-color:var(--bg-color-3);color:var(--color-4)}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   ul.actions[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:var(--bg-color-4)}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   ul.actions[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.25rem;line-height:1.75rem}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]{height:100%;overflow:hidden}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .scroll[_ngcontent-%COMP%]{height:100%;overflow-y:auto}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .scroll[_ngcontent-%COMP%]   .items[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(12,minmax(0,1fr));grid-gap:.5rem}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .scroll[_ngcontent-%COMP%]   .items[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{grid-column-start:1;grid-column-end:8;padding:.75rem;border-radius:.5rem}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .scroll[_ngcontent-%COMP%]   .items[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .item-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .scroll[_ngcontent-%COMP%]   .items[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .item-wrapper[_ngcontent-%COMP%]   .text-wrapper[_ngcontent-%COMP%]{position:relative;padding:.5rem 2.75rem .5rem 1rem;margin-left:.75rem;font-size:.875rem;line-height:1.25rem;border-radius:.75rem;background-color:var(--bg-color-chat-item);color:var(--color-1);box-shadow:#0000 0 0,#0000 0 0,#0000001a 0 1px 3px,#0000000f 0 1px 2px}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .scroll[_ngcontent-%COMP%]   .items[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .item-wrapper[_ngcontent-%COMP%]   .text-wrapper[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{position:absolute;bottom:.25rem;right:.25rem;font-size:.75rem;line-height:1rem;color:var(--color-4)}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .scroll[_ngcontent-%COMP%]   .items[_ngcontent-%COMP%]   .item.me[_ngcontent-%COMP%]{grid-column-start:6;grid-column-end:13}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .scroll[_ngcontent-%COMP%]   .items[_ngcontent-%COMP%]   .item.me[_ngcontent-%COMP%]   .item-wrapper[_ngcontent-%COMP%]{justify-content:flex-start!important;flex-direction:row-reverse}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .scroll[_ngcontent-%COMP%]   .items[_ngcontent-%COMP%]   .item.me[_ngcontent-%COMP%]   .item-wrapper[_ngcontent-%COMP%]   .text-wrapper[_ngcontent-%COMP%]{padding-right:4rem;margin-left:0;margin-right:.75rem;background-color:var(--bg-color-chat-item-me)}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .scroll[_ngcontent-%COMP%]   .items[_ngcontent-%COMP%]   .item.me[_ngcontent-%COMP%]   .item-wrapper[_ngcontent-%COMP%]   .text-wrapper[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{bottom:0;right:.5rem}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .scroll[_ngcontent-%COMP%]   .items[_ngcontent-%COMP%]   .item.me[_ngcontent-%COMP%]   .item-wrapper[_ngcontent-%COMP%]   .text-wrapper[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem;color:var(--color-4)}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .scroll[_ngcontent-%COMP%]   .items[_ngcontent-%COMP%]   .item.me[_ngcontent-%COMP%]   .item-wrapper[_ngcontent-%COMP%]   .text-wrapper[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]   i.read[_ngcontent-%COMP%]{color:#2563eb}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;padding-bottom:.5rem}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;width:100%;height:3rem;margin-left:.5rem;border:1px solid var(--color-5);border-radius:1.5rem;background-color:var(--bg-color-chat-item)}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:3rem;height:3rem;z-index:1;outline:transparent}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.5rem;line-height:2rem;color:var(--color-4)}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;height:100%;margin-left:-3rem;padding-left:3rem;margin-right:-6rem;padding-right:6rem;border-radius:1.5rem;outline:transparent;background-color:transparent;color:var(--color-1)}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button.submit[_ngcontent-%COMP%]{width:3rem;height:3rem;margin:0 .75rem;outline:transparent;color:var(--color-1);border-radius:50%;background-color:var(--bg-color-5);flex-shrink:0}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button.submit[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.5rem;line-height:2rem}"]}),u})()},1965:(Y,Z,d)=>{d.r(Z),d.d(Z,{MessagesModule:()=>st});var v=d(8583),C=d(4655),b=d(6371),x=d(4194),n=d(5184),e=d(7716),M=d(702),y=d(6832),D=d(1802),G=d(3818),R=d(2849),S=d(9029),A=d(3679),O=d(1824);function H(o,i){1&o&&(e.TgZ(0,"span",18),e._UZ(1,"span",19),e._UZ(2,"span",19),e._UZ(3,"span",19),e.qZA())}const U=function(o){return{read:o}};function z(o,i){if(1&o&&e._UZ(0,"i",20),2&o){const t=e.oxw(2).$implicit;e.Q6J("ngClass",e.VKq(1,U,t.read))}}function k(o,i){if(1&o&&(e.TgZ(0,"div",21),e._uU(1),e.qZA()),2&o){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",null==t?null:t.unReadCount," ")}}const B=function(o){return[o]};function F(o,i){if(1&o&&(e.TgZ(0,"a",9),e.TgZ(1,"div",10),e._uU(2),e.ALo(3,"date"),e.qZA(),e._UZ(4,"app-avatar",11),e.TgZ(5,"div",12),e.TgZ(6,"div",13),e._uU(7),e.YNc(8,H,4,0,"span",14),e.qZA(),e.TgZ(9,"div",15),e.YNc(10,z,1,3,"i",16),e._uU(11),e.qZA(),e.qZA(),e.YNc(12,k,2,1,"div",17),e.qZA()),2&o){const t=e.oxw().$implicit,r=e.oxw();let c,s,m,_,I,W;e.Q6J("routerLink",e.VKq(14,B,""+(null==(c=r.getOther(t))?null:c.id))),e.xp6(2),e.Oqu(e.xi3(3,11,t.date,"EEE HH:mm")),e.xp6(2),e.Q6J("url",null==(s=r.getOther(t))?null:s.image)("nameShort",null==(m=r.getOther(t))?null:m.nameShort())("firstChar",null==(_=r.getOther(t))?null:_.firstChar()),e.xp6(3),e.AsE(" ",null==(I=r.getOther(t))?null:I.firstName," ",null==(I=r.getOther(t))?null:I.lastName," "),e.xp6(1),e.Q6J("ngIf",null==(W=r.getOther(t))?null:W.isTyping()),e.xp6(2),e.Q6J("ngIf",(null==t||null==t.from?null:t.from.id)===(null==r.usersService||null==r.usersService.session?null:r.usersService.session.id)),e.xp6(1),e.hij(" ",t.text," "),e.xp6(1),e.Q6J("ngIf",null==t?null:t.unReadCount)}}function $(o,i){if(1&o&&e.YNc(0,F,13,16,"a",8),2&o){const t=i.$implicit,r=e.oxw();e.Q6J("ngIf",r.filterByInput(t))}}const J=function(){return{standalone:!0}},P=[{path:"",component:(()=>{class o{constructor(t,r,c,s,m,_){this.ss=t,this.messagesService=r,this.usersService=c,this.router=s,this.socketService=m,this.eventService=_,this.messages=[],this.input="",this.groupListLoading=!1}ngOnInit(){this.messages=[],this.groupListLoading=!1,this.getGroupList(),this.socketService.onTyping.subscribe(t=>{this.messages.forEach(r=>{var c;const s=this.getOther(r);(null===(c=t.from)||void 0===c?void 0:c.id)===(null==s?void 0:s.id)&&(null==s||s.setTyping(1===t.typing?new Date:void 0))})}),this.socketService.onRead.subscribe(t=>{this.messages.forEach(r=>{var c;const s=this.getOther(r);(null===(c=t.from)||void 0===c?void 0:c.id)===(null==s?void 0:s.id)&&(r.read=!0)})}),this.eventService.onRead.subscribe(t=>{this.messages.forEach(r=>{var c;const s=this.getOther(r);(null===(c=null==t?void 0:t.to)||void 0===c?void 0:c.id)===(null==s?void 0:s.id)&&(r.unReadCount=0)})}),this.eventService.onMessage.subscribe(t=>{let r=!1;this.messages=this.messages.map(c=>{var s;const m=this.getOther(c);return(null===(s=t.to)||void 0===s?void 0:s.id)===(null==m?void 0:m.id)?(r=!0,t.unReadCount=c.unReadCount,t):c}),r||this.messages.push(t),this.sortMessages()}),this.socketService.onMessage.subscribe(t=>{let r=!1;this.messages=this.messages.map(c=>{var s,m;const _=this.getOther(c);return(null==_?void 0:_.id)===(null===(s=t.from)||void 0===s?void 0:s.id)?(r=!0,(null===(m=n.P.to)||void 0===m?void 0:m.id)!==(null==_?void 0:_.id)&&(t.unReadCount=c.unReadCount?c.unReadCount+1:1),t):c}),r||this.messages.push(t),this.sortMessages()})}getGroupList(){this.groupListLoading||(this.groupListLoading=!0,this.messagesService.groupList(this.messages.length).subscribe(t=>{this.messages=this.messages.concat(t.map(r=>(0,x.d8)(b.v,r))),this.sortMessages(),this.groupListLoading=!1}))}sortMessages(){this.messages=this.messages.sort((t,r)=>{var c,s,m,_;return(null===(c=t.date)||void 0===c?void 0:c.getTime())>(null===(s=r.date)||void 0===s?void 0:s.getTime())?-1:(null===(m=t.date)||void 0===m?void 0:m.getTime())<(null===(_=r.date)||void 0===_?void 0:_.getTime())?1:0})}getOther(t){var r,c;return(null===(r=this.usersService.session)||void 0===r?void 0:r.id)===(null===(c=t.from)||void 0===c?void 0:c.id)?t.to:t.from}filterByInput(t){var r,c;const s=this.getOther(t),m=((null==s?void 0:s.firstName)+" "+(null==s?void 0:s.lastName)).toLocaleLowerCase("tr-TR");return 0===this.input.length||-1!==m.indexOf(this.input)||-1!==(null===(r=null==s?void 0:s.username)||void 0===r?void 0:r.indexOf(this.input))||-1!==(null===(c=null==t?void 0:t.text)||void 0===c?void 0:c.indexOf(this.input))}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(M.T),e.Y36(y.K),e.Y36(D.f),e.Y36(C.F0),e.Y36(G.$c),e.Y36(R.P))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-messages"]],decls:10,vars:5,consts:[["infiniteScroll","",1,"content",3,"scrollWindow","scrolled"],[1,"input-wrapper"],[1,"mdi","mdi-magnify"],["placeholder","Search","autocomplete","off",3,"ngModel","ngModelOptions","ngModelChange"],[1,"group-label"],[1,"items"],["ngFor","",3,"ngForOf"],[1,"router-area"],["routerLinkActive","active",3,"routerLink",4,"ngIf"],["routerLinkActive","active",3,"routerLink"],[1,"time"],[3,"url","nameShort","firstChar"],[1,"central"],[1,"name"],["class","animate-typing",4,"ngIf"],[1,"text"],["class","mdi mdi-check-all",3,"ngClass",4,"ngIf"],["class","counter",4,"ngIf"],[1,"animate-typing"],[1,"dot"],[1,"mdi","mdi-check-all",3,"ngClass"],[1,"counter"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0),e.NdJ("scrolled",function(){return r.getGroupList()}),e.TgZ(1,"div",1),e._UZ(2,"i",2),e.TgZ(3,"input",3),e.NdJ("ngModelChange",function(s){return r.input=s}),e.qZA(),e.qZA(),e.TgZ(4,"div",4),e._uU(5,"TEAM"),e.qZA(),e.TgZ(6,"div",5),e.YNc(7,$,1,1,"ng-template",6),e.qZA(),e.qZA(),e.TgZ(8,"div",7),e._UZ(9,"router-outlet"),e.qZA()),2&t&&(e.Q6J("scrollWindow",!1),e.xp6(3),e.Q6J("ngModel",r.input)("ngModelOptions",e.DdM(4,J)),e.xp6(4),e.Q6J("ngForOf",r.messages))},directives:[S.R,A.Fj,A.JJ,A.On,v.sg,C.lC,v.O5,C.yS,C.Od,O.A,v.mk],pipes:[v.uU],styles:["[_nghost-%COMP%]{background-color:var(--bg-color-1);flex-direction:row!important}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:24rem;height:100%;padding:1rem;background-color:var(--bg-color-2);overflow-x:auto}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{width:2.5rem;text-align:center;padding-left:.25rem;font-size:1.125rem;line-height:1.75rem;color:var(--color-4);z-index:1;display:flex;justify-content:center;align-items:center}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:.5rem .75rem .5rem 2.5rem;margin-left:-2.5rem;border-style:none;border-radius:.5rem;background-color:var(--bg-color-3);color:var(--color-1);outline:0}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .group-label[_ngcontent-%COMP%]{margin-top:1.25rem;color:var(--color-4);font-size:.75rem;line-height:1rem;font-weight:600}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .items[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-top:.5rem;margin-left:-1rem}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .items[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;padding:1rem 0 1rem 1rem;position:relative}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .items[_ngcontent-%COMP%] > a.active[_ngcontent-%COMP%]{border-left-width:2px;border-color:#ef4444;--tw-gradient-to: transparent;--tw-gradient-from: var(--color-4);--tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to, rgba(254, 226, 226, 0));background-image:linear-gradient(to right,var(--tw-gradient-stops))}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .items[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{position:absolute;right:0;top:0;margin-top:.75rem;color:var(--color-3);font-size:.75rem;line-height:1rem}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .items[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]   .central[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;margin-left:.5rem;color:var(--color-1);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .items[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]   .central[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .items[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]   .central[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:.75rem;line-height:1.5rem}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .items[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]   .central[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem;color:var(--color-4)}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .items[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]   .central[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   i.read[_ngcontent-%COMP%]{color:#2563eb}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .items[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]   .counter[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;align-self:flex-end;width:1.25rem;height:1.25rem;font-size:.75rem;line-height:1rem;border-radius:50%;background-color:#ef4444;color:#fff}[_nghost-%COMP%]   .router-area[_ngcontent-%COMP%]{display:flex;flex-direction:row;height:100%;width:100%;flex:1;background-image:url(/dist/undraw_reminders_697p.1733a2bb71f59b53f83c.svg);background-repeat:no-repeat;background-position:center center;background-size:80% 80%}"]}),o})(),children:[{path:":id",loadChildren:()=>d.e(913).then(d.bind(d,913)).then(o=>o.ChatModule)}]}];let l=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[C.Bz.forChild(P)],C.Bz]}),o})();var a=d(9992),g=d(2458);d(9490),d(946);let ot=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[g.uc,g.BQ],g.uc,g.BQ]}),o})();var rt=d(1354);let st=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[v.ez,l,a.ie,ot,A.u5,S.X,rt.F]]}),o})()},6832:(Y,Z,d)=>{d.d(Z,{K:()=>x});var v=d(1841),C=d(2340),b=d(7716);let x=(()=>{class n{constructor(M){this.http=M}groupList(M=0){return this.http.get(C.N.HTTP_PREFIX+"/messages/group-list/"+M)}detail(M,y=0){return this.http.get(C.N.HTTP_PREFIX+"/messages/detail/"+M+"/"+y)}add(M,y){return this.http.post(C.N.HTTP_PREFIX+"/messages/add/"+M,(new v.LE).set("text",y))}read(M){return this.http.get(C.N.HTTP_PREFIX+"/messages/read/"+M)}}return n.\u0275fac=function(M){return new(M||n)(b.LFG(v.eN))},n.\u0275prov=b.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})()}}]);